# Smart Attendance Automation System

A web-based multi-section attendance automation system built with Core PHP and MySQL, featuring separate interfaces for Admins and Operation Managers (OMs).

## Features

### Admin Panel
- Register OMs (individually or in bulk via CSV/Excel)
- Manage OM accounts (view, edit, delete)
- Automated email delivery of credentials

### Operation Manager (OM) Panel
- Secure login system
- Profile management with photo upload
- Section management (add, view, edit)
- Student list management via CSV/Excel upload
- Attendance marking using last 3 digits of roll numbers
- Google Sheets compatible binary output
- Attendance history tracking

## Technology Stack
- **Frontend**: HTML, CSS, JavaScript, Bootstrap
- **Backend**: Core PHP
- **Database**: MySQL
- **File Handling**: CSV/Excel parsing with PHP
- **Mail System**: PHP Mailer
- **Hosting**: XAMPP (Local) or cPanel (Production)

## Installation

1. Clone this repository to your web server directory
2. Import the database schema from `database/attendance_system.sql`
3. Configure database connection in `config/database.php`
4. Configure email settings in `config/mail.php`
5. Access the application through your web browser

## Database Setup

Run the SQL script in `database/attendance_system.sql` to create all necessary tables.

## Configuration

Update the following configuration files:
- `config/database.php` - Database connection settings
- `config/mail.php` - Email configuration for SMTP

## Usage

1. **Admin Access**: Use the admin panel to register Operation Managers
2. **OM Access**: OMs can log in and manage their sections
3. **Attendance Marking**: Enter last 3 digits of present students' roll numbers
4. **Export**: Copy the generated binary string to Google Sheets

## License

This project is open source and available under the MIT License. 

---

## **Why the Table and Copy Are Not Working**

### 1. **Section Roll List Source**
- The preview table is built from the `<script id="roll_list_json" type="application/json">...</script>` block.
- If this list is not dynamically generated for the current section, it will not show the correct students.
- The hidden input `#modal_section_id` must be set to the correct section before preview.

### 2. **Copy Buttons**
- The copy buttons are only enabled after preview, and only work if the preview table is filled.
- If the preview table is empty (because the roll list is not correct or not set), nothing will be copied.

---

## **What You Need to Check and Fix**

### **A. Is the Roll List Dynamic?**
- The roll list in `<script id="roll_list_json" ...>` must be generated by PHP for the **current section**.
- If you open the modal for a section, this list must contain all roll numbers for that section.

**If it is hardcoded or not updated, the preview will not work.**

---

### **B. Is the Section ID Set?**
- The hidden input `<input type="hidden" name="section_id" id="modal_section_id">` must be set to the current section’s ID **before preview**.
- If not, saving to the database will also fail.

---

### **C. How to Fix**

#### 1. **Make Sure the Roll List is Dynamic**
- When you open the modal, use PHP or AJAX to fill the roll list with all students for the selected section.
- Example (in PHP, when rendering the modal):
  ```php
  <script id="roll_list_json" type="application/json">
    <?= json_encode($all_rolls_for_this_section) ?>
  </script>
  ```

#### 2. **Set the Section ID**
- When opening the modal, set the value of `#modal_section_id` to the current section’s ID.

#### 3. **Test the Workflow**
- Open the modal for a section.
- Paste marks and click Preview.
- The table should show **all students in the section**.
- The copy buttons should work and show the alert.

---

## **If You Need Help**
- Tell me how you open the modal and how you pass the section ID and roll list.
- If you want, I can provide a code snippet to dynamically load the roll list and set the section ID when opening the modal.

---

**Summary:**  
The preview and copy logic is correct, but the roll list and section ID must be set dynamically for each section.  
**Let me know if you want a ready-to-use code snippet for this!** 

---

## **Root Cause**
- The roll list in your modal is **static** (hardcoded in the HTML).
- It does **not update** when you open the modal for a different section.
- So, the preview table only shows the roll numbers from that static list, not all students in the selected section.

---

## **How to Fix: Make the Roll List Dynamic**

### **You need to:**
1. **Generate the roll list for the current section using PHP** (or AJAX) when you open the modal.
2. **Set the value of `#modal_section_id`** to the current section’s ID.

---

### **Example Fix (PHP, when rendering the modal):**

Suppose you open the modal for a section with ID `$section_id`:

```php
<?php
// Fetch all roll numbers for this section from the database
$rolls = [];
$stmt = $db->prepare("SELECT roll_no FROM students WHERE section_id = ?");
$stmt->execute([$section_id]);
while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $rolls[] = $row['roll_no'];
}
?>
<script id="roll_list_json" type="application/json">
  <?= json_encode($rolls) ?>
</script>
<input type="hidden" name="section_id" id="modal_section_id" value="<?= htmlspecialchars($section_id) ?>">
```

- This ensures the roll list and section ID are always correct for the section you are working with.

---

### **If You Use AJAX to Open the Modal:**
- When the modal opens, make an AJAX call to fetch the roll numbers for the selected section and update the `roll_list_json` script content and the hidden section ID.

---

## **Summary Table**

| What you need to do | How to do it |
|---------------------|--------------|
| Show all students in preview | Dynamically generate the roll list for the selected section |
| Save to correct section | Set the hidden section ID input when opening the modal |

---

## **If you want, I can provide:**
- A ready-to-use PHP snippet for your modal.
- A JS+AJAX solution if you open the modal dynamically.

**Let me know which approach you use (PHP or AJAX) and I’ll give you the exact code!** 

---

## **How to Use This Snippet**

1. **When you render the modal for a section, pass the section ID to the modal.**
2. **Fetch all roll numbers for that section from the database.**
3. **Output the roll list and section ID as shown below.**

---

### **PHP Snippet for Dynamic Roll List and Section ID**

```php
<code_block_to_apply_changes_from>
<?php
// Assume $section_id is set to the current section's ID
$rolls = [];
$stmt = $db->prepare("SELECT roll_no FROM students WHERE section_id = ?");
$stmt->execute([$section_id]);
while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $rolls[] = $row['roll_no'];
}
?>
<!-- Place these inside your modal HTML -->
<script id="roll_list_json" type="application/json">
  <?= json_encode($rolls) ?>
</script>
<input type="hidden" name="section_id" id="modal_section_id" value="<?= htmlspecialchars($section_id) ?>">
```

---

### **Where to Place This**

- Place this snippet **inside the modal HTML**, replacing the old static `<script id="roll_list_json">...</script>` and the hidden section ID input.
- Make sure `$section_id` is set to the section for which the modal is being opened.

---

### **How It Works**

- When you open the modal for a section, this code will:
  - Output a JSON array of all roll numbers for that section.
  - Set the hidden input to the correct section ID.
- The JS will then use this list to build the preview table for all students in the section.

---

**If you need help integrating this into your page (for example, if you use a loop to generate modals for each section, or if you use AJAX to load the modal), let me know your setup and I’ll tailor the code for you!** 